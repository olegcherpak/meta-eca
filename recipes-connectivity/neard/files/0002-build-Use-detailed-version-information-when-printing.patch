From 95acef12eb4081615a89ad62be2f14e0913890c9 Mon Sep 17 00:00:00 2001
From: Jukka Rissanen <jukka.rissanen@linux.intel.com>
Date: Sun, 21 Apr 2013 22:34:15 +0300
Subject: [PATCH 2/2] build: Use detailed version information when printing
 neard version

---
 configure.ac | 8 ++++++++
 src/log.c    | 2 +-
 src/main.c   | 2 +-
 3 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/configure.ac b/configure.ac
index b57818c..ea3d377 100644
--- a/configure.ac
+++ b/configure.ac
@@ -134,4 +134,12 @@ AC_ARG_ENABLE(p2p, AC_HELP_STRING([--disable-p2p],
 				[enable_p2p=${enableval}])
 AM_CONDITIONAL(P2P, test "${enable_p2p}" != "no")
 
+if (test "${USE_MAINTAINER_MODE}" != "no"); then
+   GIT_COMMIT_HEAD=m4_esyscmd([sh src/get-git-head])
+else
+   GIT_COMMIT_HEAD=""
+fi
+AC_DEFINE_UNQUOTED(NEARD_DETAILED_VERSION, "${VERSION}${GIT_COMMIT_HEAD}",
+					   [neard git head])
+
 AC_OUTPUT(Makefile include/version.h neard.pc)
diff --git a/src/log.c b/src/log.c
index 99fb984..1f6a768 100644
--- a/src/log.c
+++ b/src/log.c
@@ -123,7 +123,7 @@ int __near_log_init(const char *debug, gboolean detach)
 
 	openlog("neard", option, LOG_DAEMON);
 
-	syslog(LOG_INFO, "NEAR daemon version %s", VERSION);
+	syslog(LOG_INFO, "NEAR daemon version %s", NEARD_DETAILED_VERSION);
 
 	return 0;
 }
diff --git a/src/main.c b/src/main.c
index 1a0f297..163c8f7 100644
--- a/src/main.c
+++ b/src/main.c
@@ -178,7 +178,7 @@ int main(int argc, char *argv[])
 	g_option_context_free(context);
 
 	if (option_version == TRUE) {
-		printf("%s\n", VERSION);
+		printf("%s\n", NEARD_DETAILED_VERSION);
 		exit(0);
 	}
 
-- 
1.7.11.7

