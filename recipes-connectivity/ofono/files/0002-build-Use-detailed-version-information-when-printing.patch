From 97223971e48afc26a7117dfd38dcaf63f9fa7540 Mon Sep 17 00:00:00 2001
From: Jukka Rissanen <jukka.rissanen@linux.intel.com>
Date: Sun, 21 Apr 2013 22:22:12 +0300
Subject: [PATCH 2/2] build: Use detailed version information when printing
 ofono version

---
 configure.ac | 4 ++++
 src/log.c    | 2 +-
 src/main.c   | 2 +-
 3 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/configure.ac b/configure.ac
index a4a350f..61cace6 100644
--- a/configure.ac
+++ b/configure.ac
@@ -245,5 +245,9 @@ fi
 AC_DEFINE_UNQUOTED(CONFIGDIR, "${configdir}",
 			[Directory for the configuration files])
 
+GIT_COMMIT_HEAD=m4_esyscmd([sh src/get-git-head])
+AC_DEFINE_UNQUOTED(OFONO_DETAILED_VERSION, "${VERSION}${GIT_COMMIT_HEAD}",
+					   [oFono git head])
+
 AC_OUTPUT(Makefile include/version.h src/ofono.service ofono.pc \
 		dundee/dundee.service)
diff --git a/src/log.c b/src/log.c
index febc874..4c4376f 100644
--- a/src/log.c
+++ b/src/log.c
@@ -309,7 +309,7 @@ int __ofono_log_init(const char *program, const char *debug,
 
 	openlog(basename(program), option, LOG_DAEMON);
 
-	syslog(LOG_INFO, "oFono version %s", VERSION);
+	syslog(LOG_INFO, "oFono version %s", OFONO_DETAILED_VERSION);
 
 	return 0;
 }
diff --git a/src/main.c b/src/main.c
index d6349cb..05219d4 100644
--- a/src/main.c
+++ b/src/main.c
@@ -191,7 +191,7 @@ int main(int argc, char **argv)
 	g_option_context_free(context);
 
 	if (option_version == TRUE) {
-		printf("%s\n", VERSION);
+		printf("%s\n", OFONO_DETAILED_VERSION);
 		exit(0);
 	}
 
-- 
1.7.11.7

